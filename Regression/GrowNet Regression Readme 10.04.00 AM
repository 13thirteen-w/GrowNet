######## ReadMe file for GrowNet on Regression ########

########## General Info: ##############

1. GrowNet Backup file is general file containing all codes.  All regression related codes are in Regression file : GrowNet Backup/Regression/

2. All regression data is located in server: gputest025-pa4.central.criteo.preprod /var/opt/data/user_data/s.badirli/:

# dataset                # Number of features

ca_housing                     8
YearPredictionMSD              90
slice_localization             384

3. Data loading and creating dataloader are handled in GrowNet Backup/Regression/data/data.py

4. Individual model class and ensemble architecture are in GrowNet Backup/Regression/models:  mlp.py and dynamic_net.py. 
You can increase number of hidden layers or activation function from here: mlp.py

5. All results together with hyper parameters are stored in GrowNet Backup/Regression/results folder in .npz file.

6. In each stage Boosting Net is saved to GrowNet Backup/Regression/ckpt. 

7. GrowNet Backup/Regression/main_reg_cv.py is the main script for regression task where the number of models are selected based on CV (5-10% of the training data)
are reserved for validation and tested on the Test data. You may change the normalization technique or optimizer from here

8. GrowNet Backup/Regression/train_reg.sh is the shell script that runs the code where you can also play around hyperparameters of the Boosting Net:
Parameters: (Sample example)

data = slice_localization  				       --> name of the dataset

CUDA_VISIBLE_DEVICES=1 python main_reg_cv.py \                 --> main python script to run. You may run main_reg.py but get rid of --cv parameter.
    --feat_d 384 \                                             --> Int: # of features in the data: shell script itself has the numbers commented in
    --hidden_d 128 \                                           --> Int: # of units in the hidden layer
    --boost_rate 1 \					       --> Float: Boost rate to weight the model outputs for final output
    --lr 0.005 \					       --> Float: Learning rate	
    --L2 .0e-3 \					       --> Float: L2 regularization rate (weight decay)	
    --num_nets 40 \					       --> Int: Max number of models in the net	 
    --data ${data} \					       --> Assigning data from above	
    --tr /var/opt/data/user_data/s.badirli/${data}_tr.npz \    --> Path to the training data 
    --te /var/opt/data/user_data/s.badirli/${data}_te.npz \    --> Path to the test data
    --batch_size 2048 \					       --> Int: Training batch size	
    --epochs_per_stage 1 \				       --> Int: Number of epochs for training each model: generally set to 1 sometimes 2
    --correct_epoch 1 \					       --> Int: Number of epochs for the Corrective step: generally set to 1 or 2
    --normalization True \				       --> Boolean: Normalization, in regression, standardization to apply or Not
    --cv True \						       --> Boolean: Performing CV to select number of models in the Boosting, reserving 5-10% of the training data. You can change the percentage inside of main script: get_data()
    --out_f ./ckpt/${data}_reg.pth \			       --> Saving the model in each stage (new model added) to this file 
    --cuda 						       --> Cuda option: On our case it is ON



########## How top Run the Code ##############

1. Change your directory to GrowNet Backup/Regression/

2. Open train_reg.sh shell script (vim train_reg.sh) and follow these steps:
	
	a. Choose the data name you want to try: data = slice_localization
	
	b. Change --feat_d into the number of features the dataset has: in the case of slice_localization  384
	
	c. You may want to adjust the number of units in hidden layer based on the dataset: I generally choose the hidden_d something between  feat_d/4 and 3*feat_d/4
	If the hidden_d is very big then models overfits otherwise if very small can't learn.

	d. If you want to try  new Regression data then be sure you put it into .npz format with the name analogous to --tr and --te. 
	   For now please also add the data name into manuscript in the get_data() function.

	e. The rest is optional: you may or may not change 

3. To enforce the changes you have done run this line on command line: chmod +x train_reg.sh

4. Finally run the script by executing this line on command window: ./train_reg.sh


